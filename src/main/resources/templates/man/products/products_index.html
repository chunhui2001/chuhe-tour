{{#partial "blocks/title"}}
<title>产品管理 - 所有产品</title>
{{/partial}}



{{#partial "content" }}
<h1>产品管理 - 所有产品</h1>

{{#if errorTrace }}
<pre>{{errorTrace}}</pre>
{{/if}}

{{#if flashMessage}}
<div style="color: brown">
    {{flashMessage}}
</div>
{{/if}}

<div>
    <form action="/mans/products" method="POST">
        产品名称：<input type="text" name="product_name" required placeholder="请输入产品名称"/>  <br />
        产品单位：<input type="text" name="product_unit" required placeholder="请输入产品单位" />  <br />
        产品单价：<input type="float" name="product_price" required placeholder="请输入产品单价" />  <br />
        产品规格：<input type="text" name="product_spec" placeholder="请输入产品规格" />  <br />
        产品描述：<textarea type="text" name="product_desc" placeholder="请输入产品描述"></textarea><br />
        <input type="submit" value="保存" />
        <input type="reset" value="清除" />
    </form>
</div>

<div>
    <input type="button" id="btn-product-new" value="新增产品"  style="float:left;" />

    <form action="/mans/products" method="POST" style="float:left;">
        <input type="hidden" name="_method" value="delete" />
        <input type="hidden" id="product_ids" name="product_ids" value="" />
        <input type="submit" id="btn-product-del" value="删除所有选中" />
    </form>
    <div class="clearFixed"></div>
</div>

<div>

    <table>
        <thead>
            <tr>
                <th>&ensp;</th>
                <th>产品编号</th>
                <th>产品名称</th>
                <th>单位</th>
                <th>单价</th>
                <th>规格</th>
                <!--<th>产品描述</th>-->
                <th>更新时间</th>
                <th>&nbsp;</th>
            </tr>
        </thead>
        <tbody class="product-list">

            {{#compare viewData.length 'gt' 0 }}
                {{#each viewData}}
                <tr>
                    <td><input type="checkbox" id="{{product_id}}" name="{{product_id}}" value="{{product_id}}" /></td>
                    <td>{{product_id}}</td>
                    <td>{{product_name}}</td>
                    <td>{{product_unit}}</td>
                    <td>{{product_price}}</td>
                    <td>{{product_spec}}</td>
                    <!--td>{{product_desc}}</td-->
                    <td>{{last_updated}}</td>
                    <td><a href="/mans/products/{{product_id}}">产品详情</a></td>
                </tr>
                {{/each}}
            {{/compare}}

            {{#compare viewData.length 'eq' 0 }}
            <td colspan="7">当前还没有任何产品 ~</td>
            {{/compare}}

        </tbody>
    </table>


</div>

{{/partial}}



{{#partial "blocks/script"}}
<script type="text/javascript" id="r_1">


    $(function() {

        setBtnDelEnabled();

        $(".product-list :checkbox").on("click", function () {

            setBtnDelEnabled();
            setProductIds($(this).is(":checked"), $(this).val());

        });
    });

    function setBtnDelEnabled() {
        if ($(".product-list :checkbox:checked").length > 0) {
            $("#btn-product-del").attr("disabled", false);
        } else {
            $("#btn-product-del").attr("disabled", true);
        }
    }

    function setProductIds(ischeck, productid) {

        if (ischeck) {

            if ($("#product_ids").val().length == 0) {
                $("#product_ids").val(productid);
            }


            if ($("#product_ids").val().length > 0 && !isSelected(productid)) {
                $("#product_ids").val($("#product_ids").val() + "," + productid);
            }

            return;
        }

        removeProductId(productid);

    }

    function isSelected(productid) {
        return ("," + $("#product_ids").val() + ",").indexOf(',' + productid + ',') != -1;
    }

    function removeProductId(productid) {

        if (!isSelected (productid) || $("#product_ids").val().length == 0) {
            return;
        }

        var newValue = ("," + $("#product_ids").val() + ",").replace("," + productid + ",", "," );

        $("#product_ids").val(newValue.substr(1, newValue.length - 2));

    }

</script>
{{/partial}}


{{> layouts/layout_default}}
