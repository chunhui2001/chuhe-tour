function CalculateTable(t,e,n,r,i){this.tableBodySelector="tbody"+t,this.pk=e,this.priceFieldId=n,this.countFieldId=r,this.totalMoneyFieldId=i}function isOnlyOneRow(t){return 1==$(t.tableBodySelector).find(">tr").length}function setRowNumber(t,e){$(t).find("input:text:first").val(e)}function removeOrderRow(t,e){var n=$(e).parents("tr")[0];isOnlyOneRow(t)?clearOrderRow(t,n,1):($(n).remove(),resortOrderRowNumber(t))}function clearOrderRow(t,e,n){$(e).find("input:text").val(""),$(e).removeAttr(t.pk),n&&$(e).find("input:text:first").val(n)}function resortOrderRowNumber(t){$(t.tableBodySelector).find(">tr").each(function(t){setRowNumber(this,t+1)})}function calculateOrderItemTotalMoney(t,e){var n=$(e).find("#"+t.countFieldId).val(),r=$(e).find("#"+t.priceFieldId).val(),i=(isNaN(n)?0:n)*(isNaN(r)?0:r);$(e).find("input:text[id='"+t.totalMoneyFieldId+"']").val(i.toFixed(2))}function getOrderDetailItemCount(t){return $(t.tableBodySelector).find(">tr").length}function keyUpOrDownInCells(t){var e=t;$(document).on("keydown",e.tableBodySelector+" input:text",function(t){var n=t.keyCode||t.which;if("40"==n||"38"==n){var r="40"==n,i=$(this).parents("tr")[0],o=$(this).parents("td")[0],a=$(i).prevAll("tr").length,l=$(o).prevAll("td").length,c=r?a+1:a-1;c<0||c>getOrderDetailItemCount(e)-1||$(e.tableBodySelector).find(">tr:eq("+c+")").find("input:text:eq("+l+")").focus()}})}function inputFormatAndCheck(t){var e=t;$(document).on("keydown","#"+e.priceFieldId+",#"+e.countFieldId,function(t){var e=t.keyCode||t.which;if((e<48||e>57)&&-1==[8,9,13,16,17,37,39,67,86,188,190].indexOf(e))return!1}),$(document).on("input","#"+e.priceFieldId+",#"+e.countFieldId,function(t){var n=t.keyCode||t.which,r=parseFloat($(this).val());""!=$(this).val().trim()&&isNaN(r)?$(this).val("0.00"):(86==n&&$(this).val(r),e.calculateOrderItemTotalMoney($(this).parents("tr")[0]))})}function enterOrTabToSearchfunction(t,e,n){var r=t;$(document).on("keydown","#"+r.pk,function(t){var n=t.keyCode||t.which;if("9"==n||"13"==n){var i=$(this).val(),o=$(this).parents("tr")[0];$(o).attr(r.pk)!=i.trim()&&r.getData(e,i,function(t,e){t||404==e.code||r.fillOutOrderDetailItem(o,e.data)})}})}function removeEmptyOrderDetailItemRow(t,e){$("#"+e).on("click",function(){$(t.tableBodySelector).find(">tr").each(function(e){if(!t.isOnlyOneRow()){var n=!0;$(this).find("input:text:not(:first)").each(function(){if($(this).val().length>0)return n=!1,!1}),n&&($(this).remove(),t.resortOrderRowNumber())}})})}CalculateTable.prototype={init:function(){keyUpOrDownInCells(this),inputFormatAndCheck(this)},calculateOrderItemTotalMoney:function(t){calculateOrderItemTotalMoney(this,t)},removeOrderRow:function(t){removeOrderRow(this,t)},setRowNumber:function(t,e){setRowNumber(t,e)},resortOrderRowNumber:function(){resortOrderRowNumber(this)},isOnlyOneRow:function(){return isOnlyOneRow(this)},clearOrderRow:function(t,e){clearOrderRow(this,t,e)},fillOutOrderDetailItem:function(t,e){Object.keys(e).forEach(function(n){$(t).find("input:text[id='"+n+"']").val(e[n])}),$(t).attr(this.pk,e[this.pk]),calculateTable.calculateOrderItemTotalMoney(t)},enterOrTabToSearch:function(t,e){enterOrTabToSearchfunction(this,t,e)},getData:function(t,e,n){t=t+"/"+e+".json",fetch(t,{method:"get",credentials:"same-origin"}).then(function(t){return t.json()}).then(function(t){return n(t.error,t)}).catch(function(t){})},removeEmptyOrderDetailItemRow:function(t){removeEmptyOrderDetailItemRow(this,t)},removeOrderItemRow:function(t){$this=this,$(document).on("click",t,function(){removeOrderRow($this,this)})},newOrderRow:function(t){var e=this;$(t).on("click",function(){var t=$(calculateTable.tableBodySelector).find(">tr").length,n=$(calculateTable.tableBodySelector).find(">tr:last"),r=n.clone();e.clearOrderRow(r),e.setRowNumber(r,t+1),n.after(r)})},getOrderDetailItems:function(t){var e=this,n=[];return $(e.tableBodySelector).find(">tr").each(function(){var r={};if($(this).attr(e.pk)&&0!=$(this).attr(e.pk).trim().length){for(var i=0;i<t.length;i++)r[t[i]]=$(this).find("input:text[id='"+t[i]+"']").val(),e.countFieldId!=t[i]&&e.priceFieldId!=t[i]||(r[t[i]]=parseFloat(r[t[i]]),isNaN(r[t[i]])&&(r[t[i]]=0),r[t[i]]=new Number(r[t[i]]).toFixed(2));n.push(r)}}),n},appendOrderItemsToForm:function(t,e,n,r){for(var i=this.getOrderDetailItems(t),o=0;o<i.length;o++)$("<input type='hidden' name='"+n+o+"' value='"+JSON.stringify(i[o])+"' />").appendTo($(e));$("<input type='hidden' name='"+r+"' value='"+i.length+"' />").appendTo($(e))}};