{{#partial "blocks/title"}}
<title>进货管理</title>
{{/partial}}


{{#partial "blocks/styles"}}
<style type="text/css">



</style>
{{/partial}}

{{#partial "content" }}
<h3>进销存管理 -- 进货管理</h3>

{{#if errorTrace }}
<pre>{{errorTrace}}</pre>
{{/if}}

{{#if flashMessage}}
<div class="flash-message">
    {{flashMessage}}
</div>
{{/if}}

<div style="display: none;" class="orders-new-replenish-order-form">

    <app-root></app-root>

</div>

<div style="text-align: right;">
    <button class="button ssmall2 primary" type="button" id="btn-orders-new-replenish-order">新增进货单</button>
</div>


<fieldset>
    <legend style="font-weight: bold;color:gray;">历史进货单</legend>
    <div>

    <table class="table-basic" style="width: 100%;">

        <thead>
        <tr>
            <th>单据编号</th>
            <th>单据流水号</th>
            <th style="text-align: center;">单据类型</th>
            <th style="text-align: right;">金额</th>
            <th style="text-align: center;">进货日期</th>
            <th style="text-align: center;">经办人</th>
            <th style="text-align: center;">备注</th>
            <th>&nbsp;</th>
        </tr>
        </thead>
        <tbody class="replenish-order-list">

        {{#compare viewData.length 'gt' 0 }}
        {{#each viewData}}
        <tr>
            <td style="text-align: center;">{{order_id}}</td>
            <td style="text-align: center;">{{order_flow_no}}</td>
            <td style="text-align: center;">{{order_type_name}}单</td>
            <td style="text-align: right;">{{order_money}}</td>
            <td style="text-align: center;">{{order_date}}</td>
            <td style="text-align: center;">{{order_person}}</td>
            <td style="text-align: center;">{{order_desc}}</td>
            <td><a href="/mans/orders/replenish/{{order_id}}">单据详情</a></td>
        </tr>
        {{/each}}
        {{/compare}}


        {{#compare viewData.length 'eq' 0 }}
        <td colspan="7">当前还没有任何进货单据 ~</td>
        {{/compare}}

        </tbody>
    </table>


</div>
</fieldset>
{{/partial}}



{{#partial "blocks/script"}}
<script type="text/javascript" src="/assets/scripts/table/table-calculate.js"></script>
<script type="text/javascript" id="r_1">


    var productModelFields = [ 'product_id', 'product_price', 'product_buy_count', 'order_item_desc' ];
    var calculateTable = new CalculateTable(".order-detail-replenish-items", "product_id", 'product_price', 'product_buy_count', 'product_total_money');

    $(function () {

        calculateTable.init();

        $("#btn-order-save").on("click", function () {
            calculateTable.appendOrderItemsToForm(productModelFields, "#orders-order-detail-form", "order_item_", "order_item_count");
            $("#orders-order-detail-form").submit();
        });

        $("#btn-orders-new-replenish-order").on("click", function () {
            $(".orders-new-replenish-order-form").show();
        });

        calculateTable.newOrderRow("#btn-append-new-order-row");
        calculateTable.removeEmptyOrderDetailItemRow("btn-clean-order-row");
        calculateTable.removeOrderItemRow(".remove-order-row");
        calculateTable.enterOrTabToSearch("/mans/products");

        for (var i=0; i<4; i++) {
            $("#btn-append-new-order-row").click();
        }



    });


</script>
{{/partial}}


{{> layouts/layout_default}}
