{{#partial "blocks/title"}}
<title>销售管理</title>
{{/partial}}



{{#partial "content" }}
<h3>进销存管理 -- 销售管理</h3>

{{#if errorTrace }}
<pre>{{errorTrace}}</pre>
{{/if}}

{{#if flashMessage}}
<div class="flash-message" style="color: brown">
    {{flashMessage}}
</div>
{{/if}}
<app-root></app-root>

<div style="display: none;" class="orders-new-sales-order-form">
    <form class="small-form" id="orders-order-detail-form" action="/mans/orders/sales" method="POST">
        <fieldset style="margin-bottom: 1em;">
            <legend style="font-weight: bold;color:gray;">新增销售单</legend>


            <div>
                <label for="order_flow_no">销单流水号：</label>
                <input type="text" id="order_flow_no" name="order_flow_no" required placeholder="请输入销单流水号"/>&ensp;&ensp;&ensp;
            </div>

            <div>
                <label for="order_flow_no">经办人：</label>
                <input type="text" id="order_person" name="order_person" placeholder="请输入经办人"/>&ensp;&ensp;&ensp;
            </div>

            <!--
            客户姓名：<input type="text" name="customer_name" required placeholder="请输入客户姓名" />&ensp;&ensp;&ensp;&ensp;
            联系方式：<input type="text" name="customer_phone" required placeholder="请输入客户联系方式" />&ensp;&ensp;&ensp;&ensp;
            -->

            <div>
                <label for="order_flow_no">备注：</label>
                <input type="text" id="order_desc" name="order_desc" placeholder="请输入销单备注"/>&ensp;&ensp;&ensp;
            </div>


        </fieldset>

        <fieldset style="margin-bottom: 1em;">

            <div style="margin-bottom: -1em; text-align: right">
                <a style="float:right;" id="btn-append-new-order-row" class="ssmall primary button">增加新行</a>
                <div class="clearFixed"></div>
            </div>
            <div style="text-align: left">
                <legend style="font-weight: bold;color:gray;">销售单详情</legend>
            </div>


            <div class="order-detail-sales">

                <table class="table-cells" border="0" cellspacing="0">
                    <thead>
                    <tr>
                        <th>序号</th>
                        <th>商品编号</th>
                        <th style="width:385px;">商品名称</th>
                        <th>品牌</th>
                        <th>规格</th>
                        <th>销售单价</th>
                        <th>单位</th>
                        <th>数量</th>
                        <th>合计金额</th>
                        <th>生产厂家</th>
                        <th>备注</th>
                        <th>&ensp;</th>
                    </tr>
                    </thead>
                    <tbody class="order-detail-sales-items">
                    <tr>
                        <td style="width: 40px;text-align: center;font-weight: bold;">
                            <input type="text" autocomplete="off" disabled="disabled" style="text-align: center;" value="1" /></td>
                        <td><input type="text" autocomplete="off" id="product_id" /></td>
                        <td style="width:385px;"><input type="text" autocomplete="off" id="product_name" /></td>
                        <td><input type="text" autocomplete="off" disabled="disabled" style="text-align: center;" id="product_brand" /></td>
                        <td><input type="text" autocomplete="off" disabled="disabled" id="product_spec" /></td>
                        <td><input type="text" autocomplete="off" style="text-align: right;" id="product_price" /></td>
                        <td><input type="text" autocomplete="off" disabled="disabled" style="text-align: center;" id="product_unit" /></td>
                        <td><input type="text" autocomplete="off" style="text-align: center;" id="product_sale_count" /></td>
                        <td><input type="text" autocomplete="off" disabled="disabled" style="text-align: right;" id="product_total_money" /></td>
                        <td><input type="text" autocomplete="off" disabled="disabled" id="product_vender" /></td>
                        <td><input type="text" autocomplete="off" id="order_item_desc" /></td>
                        <td style="width: 40px;text-align: center;"><a title="删除该行" class="remove-order-row" href="javascript:void(this);">&Chi;</a></td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div style="text-align: center;margin: 1.5em 0;">
                <a type="button" id="btn-order-save" class="small primary button">保存</a>
                <!--<button type="button" id="btn-order-save" class="small primary button">保存</button>-->
                <button type="button" id="btn-clean-order-row" class="small clear button">清除空行</button>
            </div>


        </fieldset>
    </form>
</div>


<div style="text-align: right;">
    <button class="button ssmall2 primary" type="button" id="btn-product-new-sales-order">新增销售单</button>
</div>

<fieldset>

    <legend style="font-weight: bold;color:gray;">历史销售单</legend>

    <div>

        <table class="table-basic" style="width: 100%;">
            <thead>
            <tr>
                <th>单据编号</th>
                <th>单据流水号</th>
                <th>单据类型</th>
                <th style="text-align: right;">金额</th>
                <th>销售日期</th>
                <th>经办人</th>
                <th>备注</th>
                <th>创建时间</th>
                <th>&nbsp;</th>
            </tr>
            </thead>
            <tbody class="sales-order-list">

            {{#each viewData}}
            <tr>
                <td style="text-align: center;">{{order_id}}</td>
                <td style="text-align: center;">{{order_flow_no}}</td>
                <td style="text-align: center;">{{order_type_name}}单</td>
                <td style="text-align: right;">{{order_money}}</td>
                <td style="text-align: center;">{{order_date}}</td>
                <td style="text-align: center;">{{order_person}}</td>
                <td style="text-align: center;">{{order_desc}}</td>
                <td style="text-align: center;">{{created_at}}</td>
                <td><a href="/mans/orders/sales/{{order_id}}">单据详情</a></td>
            </tr>
            {{/each}}


            {{#compare viewData.length 'eq' 0 }}
            <td colspan="9">当前还没有任何销售单据 ~</td>
            {{/compare}}

            </tbody>
        </table>


    </div>
</fieldset>

{{/partial}}



{{#partial "blocks/script"}}
<script type="text/javascript" src="/scripts/table/table-calculate.js"></script>
<script type="text/javascript" id="r_1">

    var productModelFields = [ 'product_id', 'product_price', 'product_sale_count', 'order_item_desc' ];
    var calculateTable = new CalculateTable(".order-detail-sales-items", "product_id", 'product_price', 'product_sale_count', 'product_total_money');

    $(function () {

        calculateTable.init();

        $("#btn-order-save").on("click", function () {
            calculateTable.appendOrderItemsToForm(productModelFields, "#orders-order-detail-form", "order_item_", "order_item_count");
            $("#orders-order-detail-form").submit();
        });

        $("#btn-product-new-sales-order").on("click", function () {
            $(".orders-new-sales-order-form").show();
        });

        calculateTable.newOrderRow("#btn-append-new-order-row");
        calculateTable.removeEmptyOrderDetailItemRow("btn-clean-order-row");
        calculateTable.removeOrderItemRow(".remove-order-row");
        calculateTable.enterOrTabToSearch("/mans/products");

        for (var i=0; i<4; i++) {
            $("#btn-append-new-order-row").click();
        }

    });


</script>
{{/partial}}


{{> layouts/layout_default}}
